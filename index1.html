<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>MyPets</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,500,500i,700|Barriecito" rel="stylesheet">
  <link rel="stylesheet" href="./style1.css">
</head>

<body>

  <main>
    <section>
      <nav>
        <div class="logo">
          <div class="text">MyPets</div>
        </div>
      </nav>
      <div class="dog-info">
        <section class="dog-name">
          <div class="dog-name__info">
            <h1 id="cod">.</h1>
          </div>
        </section>
        <section class="dog-gallery">
          <input class="dog-gallery__input" id="gallery-image-1" type="radio" value="1" name="dog-image" checked="checked" />
          <div class="dog-gallery__images">
            <img src="" alt="Dog Image" id="dog-image" />
          </div>
        </section>
        <section class="dog-manythings">
          <div class="dog-manythings__stats">
            <p>Nombre </p>
            <h5 id="Nom"> .</h5>
          </div>
          <div class="dog-manythings__stats">
            <p>Fecha de nacimiento </p>
            <h5 id="Fech">.</h5>
          </div>
          <div class="dog-manythings__stats">
            <p>Departamento</p>
            <h5 id="Dep">.</h5>
          </div>
          <div class="dog-manythings__stats">
            <p>Municipio</p>
            <h5 id="Mun">.</h5>
          </div>
          <div class="dog-manythings__stats">
            <p>Dirección</p>
            <h5 id="Direc">.</h5>
          </div>
          <div class="dog-manythings__more">
            <h3>Más información</h3>
            <p> <strong>Contacto </strong>
              <h5 id="Contc">.</h5>
            </p>
            <p> <strong>Email </strong>
              <h5 id="Ema">.</h5>
            </p>

            <div class="dog-manythings__more">
              <h3>Registro de vacunas</h3>
            </div>

            <div class="dog-manythings__more">
              <h3>
                <table class="container">
                  <thead>
                    <tr>
                      <th>
                        <h1>Vacunas</h1>
                      </th>
                      <th>
                        <h1>Fecha colocada</h1>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                     
                    </tr>
                  </tbody>
                </table>
              </h3>
            </div>
          </div>
        </section>

        <script>
          // Función para obtener parámetros de la URL por nombre
          function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return "";
            return decodeURIComponent(results[2].replace(/\+/g, " "));
          }

          // Obtiene el código de la mascota de los parámetros de la URL
          const codigoMascota = getParameterByName("codigoMascota");

          // Verifica si se proporcionó el código de la mascota en la URL
          if (codigoMascota) {
            // Realiza una solicitud a tu API para obtener los datos de la mascota
            const apiUrl =
              "http://localhost/MyPets_Admin/servicios/prc/prc_mascota.php?accion=C&codigo=" + codigoMascota;

            fetch(apiUrl)
              .then(response => {
                if (!response.ok) {
                  throw new Error(`Error en la solicitud: ${response.statusText}`);
                }
                return response.json();
              })
              .then(data => {
                // Verifica si la respuesta de la API es verdadera
                if (data.status === 1) {
                  // Aquí puedes actualizar el contenido de tu página con los datos de la mascota
                  const nombreMascota = data.info[0].mascota.nmasc;
                  const fechanacimiento = data.info[0].mascota.nacim;
                  const Departamento = data.info[0].mascota.depto;
                  const Municipio = data.info[0].mascota.muni;
                  const direcciones = data.info[0].mascota.direccion;
                  const tel = data.info[0].mascota.telefono;
                  const mails = data.info[0].mascota.mail;

                  // Actualiza el contenido de tu página con el nombre de la mascota u otros datos necesarios
                  document.getElementById("Nom").innerText = nombreMascota;
                  document.getElementById("cod").innerText = codigoMascota;
                  document.getElementById("Fech").innerText = fechanacimiento;
                  document.getElementById("Dep").innerText = Departamento;
                  document.getElementById("Mun").innerText = Municipio;
                  document.getElementById("Direc").innerText = direcciones;
                  document.getElementById("Contc").innerText = tel;
                  document.getElementById("Ema").innerText = mails;

                  // Obtén la referencia al cuerpo de la tabla
                  const tbody = document.querySelector('.container tbody');

                  if (data.info[0].vacuna && (Array.isArray(data.info[0].vacuna) || typeof data.info[0].vacuna === "object")) {
                    // Si es un objeto, conviértelo en un array
                    var vacunas = Array.isArray(data.info[0].vacuna) ? data.info[0].vacuna : [data.info[0].vacuna];

                    // Itera sobre las vacunas
                    vacunas.forEach(function (vacuna) {
                      var newRow = tbody.insertRow();
                      var vacunaCell = newRow.insertCell(0);
                      var fechaColocCell = newRow.insertCell(1);

                      vacunaCell.textContent = vacuna.nombrevacuna || "N/A";
                      fechaColocCell.textContent = vacuna.fecha_creacion || "N/A";
                    });
                  } else {
                    console.error("El campo 'vacuna' no es un array u objeto en la respuesta de la API.");
                  }

                  // Verifica si la respuesta contiene la URL de la imagen
                  if (data.info[0].mascota.foto) {
                    // Realiza una solicitud para obtener la imagen en formato base64
                    return fetch(data.info[0].mascota.foto);
                  } else {
                    throw new Error("La respuesta de la API no contiene la URL de la imagen.");
                  }
                } else {
                  throw new Error("Error al obtener los datos de la mascota.");
                }
              })
              .then(response => {
                if (!response.ok) {
                  throw new Error(`Error al cargar la imagen: ${response.statusText}`);
                }
                return response.blob();
              })
              .then(blob => {
                // Convierte el blob en una URL de datos
                return URL.createObjectURL(blob);
              })
              .then(imageUrl => {
                // Asigna la URL de la imagen al atributo src de la etiqueta img
                document.getElementById("dog-image").src = imageUrl;
              })
              .catch(error => {
                console.error("Error al obtener datos", error);
              });
          } else {
            alert("Código de mascota no proporcionado en la URL.");
          }
        </script>
      </div>
    </section>
  </main>

</body>

</html>